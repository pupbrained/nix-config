#!/usr/bin/env bash
set -eo pipefail

nix run nixpkgs#alejandra -- . -q
nix run nixpkgs#statix -- fix .

if [ "$1" == "sys" ] || [ "$1" == "-s" ]; then
  nix-shell -p git --run "nixos-rebuild switch --flake .# --impure --use-remote-sudo --option sandbox false"
elif [ "$1" == "home" ] || [ "$1" == "-h" ]; then
  nix run .#update-home
else
  nix-shell -p git --run "nixos-rebuild switch --flake .# --impure --use-remote-sudo --option sandbox false"
  nix run .#update-home
fi
